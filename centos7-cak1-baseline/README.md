# govready/centos7-cak1-baseline

This directory is used by GovReady engineers to build the `centos7-cak1-baseline` image and push it to Docker Hub.  The image is pulled from Docker Hub to your computer, and used by the main [Jenkinsfile](../Jenkinsfile) to instantiate the **Target App Server**.

## Build `centos7-cak1-baseline` Image
```
docker build --tag govready/centos7-cak1-baseline:latest .
```

## Push to Docker Hub
```
docker push govready/centos7-cak1-baseline:latest
```

# Creating fix.sh

This script is a concatentation of remediation snippets automatically generated by OpenSCAP.  We use this to apply remediations to the image we're building.  It's not perfect, but it does effect some remediations.

It is generated with these commands, run inside a container with OpenSCAP installed, and needing fixes:

```
oscap xccdf eval --profile nist-800-171-cui  --fetch-remote-resources --results scan-results.xml --report scan-report.html /usr/share/xml/scap/ssg/content/ssg-centos7-xccdf.xml
oscap xccdf generate fix --fetch-remote-resources --result-id xccdf_org.open-scap_testresult_nist-800-171-cui scan-results.xml > fix.sh
```

After it's generated, copy it out of the container and into your copy of the repo directory (customize the `docker exec` command with the name of your container, and the directory within the container where you generated the `fix.sh` file):

```
cp fix-sh-preamble.txt fix.sh
docker exec -it tmp-cak1-baseline cat /fix.sh >>fix.sh
chmod +x fix.sh
```

If you are on a Unix-based system, you may need to remove carriage return characters from `fix.sh` with something like `tr -d '\r'` or `sed 's/\r//'`.
